name: Manual CI

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Choose environment"
        type: choice
        options:
          - staging
          - staging-canary
          - prod
          - prod-canary
        required: true
        default: staging
#      staging:
#        description: "Deploy to staging"
#        type: boolean
#        required: true
#      staging_canary:
#        description: "Deploy to staging-canary"
#        type: boolean
#        required: true
#      prod:
#        description: "Deploy to prod"
#        type: boolean
#        required: true
#      prod_canary:
#        description: "Deploy to prod-canary"
#        type: boolean
#        required: true

jobs:
  log:
    name: Logs inputs
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup
        run: echo "${{ github.event.inputs.environment }} and ${{ github.ref }}"

# --- Staging canary --- #

  environment_staging:
    if: github.event.inputs.environment == 'staging'
    name: 'Environment staging'
    runs-on: ubuntu-latest

    steps:
      - name: "Checkout to the code" 
        uses: actions/checkout@v3

      - name: Launch setup
        run: ./setup_a.sh
        
# --- Staging canary --- #

  environment_staging_canary:
    if: github.event.inputs.environment == 'staging-canary'
    name: 'Environment staging-canary'
    runs-on: ubuntu-latest

    steps:
      - name: "Checkout to the code" 
        uses: actions/checkout@v3

      - name: Launch setup
        run: ./setup_a.sh
        
# --- Prod --- #

  environment_prod:
    if: github.event.inputs.environment == 'prod' && github.ref == 'master'
    name: 'Environment prod'
    runs-on: ubuntu-latest

    steps:
      - name: "Checkout to the code" 
        uses: actions/checkout@v3

      - name: Launch setup
        run: ./setup_b.sh
        
# --- Prod --- #

  environment_prod_canary:
    if: github.event.inputs.environment == 'prod-canary'
    name: 'Environment prod-canary'
    runs-on: ubuntu-latest

    steps:
      - name: "Checkout to the code" 
        uses: actions/checkout@v3

      - name: Launch setup
        run: ./setup_b.sh
